<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sion.ai ‚Äî Aprenda. Entenda. Evolua.">
    <meta name="theme-color" content="#6a5af9">
    <meta name="robots" content="index, follow">

    <!-- LGPD / Privacy -->
    <meta name="privacy-policy" content="https://politicas.cici.net.br">

    <title>Sion.ai - Aprenda. Entenda. Evolua.</title>

    <!-- PWA Manifest & Icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="https://i.imgur.com/qpeNAU8.png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/qpeNAU8.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sion AI">

    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://clarity.microsoft.com/clarity.js";
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window,document,"clarity","script","tlya8thx8r");
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-REPLACE_WITH_YOUR_PUBLISHER_ID" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ============================================================
           RESET & VARIABLES
        ============================================================ */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary:    #6a5af9;
            --secondary:  #d66efd;
            --accent:     #ff8e6e;
            --dark:       #1a1a2e;
            --darker:     #0f0c29;
            --light:      #f8f9fa;
            --gray:       #6c757d;
            --card-bg:    rgba(26, 26, 46, 0.75);
            --card-border:rgba(255,255,255,0.08);
            --input-bg:   rgba(0,0,0,0.30);
            --radius:     18px;
            --font-head:  'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-head);
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            background-attachment: fixed;
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* ============================================================
           SCREEN SYSTEM ‚Äî only one screen visible at a time
        ============================================================ */
        .screen {
            display: none;
            min-height: 100vh;
            flex-direction: column;
            animation: screenIn 0.4s cubic-bezier(.4,0,.2,1);
        }
        .screen.active { display: flex; }

        @keyframes screenIn {
            from { opacity: 0; transform: translateY(12px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ============================================================
           TOP NAV BAR (shared across screens)
        ============================================================ */
        .topbar {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 200;
            background: rgba(15,12,41,0.82);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-bottom: 1px solid rgba(106,90,249,0.25);
            padding: 0.9rem 1.6rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .topbar__logo {
            display: flex; align-items: center; gap: 0.7rem;
            text-decoration: none;
            flex-shrink: 0;
        }
        .topbar__logo img {
            width: 38px; height: 38px;
            border-radius: 50%;
            border: 2px solid var(--secondary);
            box-shadow: 0 0 10px rgba(214,110,253,0.4);
            object-fit: cover;
        }
        .topbar__logo-text h1 {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text; background-clip: text;
            color: transparent;
            line-height: 1.1;
        }
        .topbar__logo-text span {
            font-size: 0.65rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }

        .topbar__nav {
            display: flex; gap: 0.4rem;
        }
        .topbar__nav button {
            background: transparent;
            border: 1px solid transparent;
            color: rgba(255,255,255,0.6);
            padding: 0.45rem 1rem;
            border-radius: 50px;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
            font-family: inherit;
        }
        .topbar__nav button:hover {
            color: #fff;
            background: rgba(106,90,249,0.15);
        }
        .topbar__nav button.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            border-color: transparent;
            box-shadow: 0 3px 12px rgba(106,90,249,0.35);
        }

        /* PWA install banner */
        #pwa-banner {
            display: none;
            position: fixed; top: 60px; left: 50%;
            transform: translateX(-50%);
            z-index: 190;
            background: rgba(15,12,41,0.92);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(106,90,249,0.35);
            border-radius: 14px;
            padding: 0.8rem 1.2rem;
            gap: 1rem;
            align-items: center;
            max-width: 380px; width: 90%;
            box-shadow: 0 8px 30px rgba(0,0,0,0.35);
            animation: slideDown 0.35s ease;
        }
        #pwa-banner.show { display: flex; }
        @keyframes slideDown {
            from { opacity:0; transform: translateX(-50%) translateY(-10px); }
            to   { opacity:1; transform: translateX(-50%) translateY(0); }
        }
        #pwa-banner p { font-size: 0.82rem; color: #ccc; flex:1; }
        #pwa-banner p strong { color: var(--secondary); }
        .pwa-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none; color: #fff;
            padding: 0.4rem 0.9rem;
            border-radius: 50px;
            font-size: 0.75rem; font-weight: 700;
            cursor: pointer; white-space: nowrap;
            font-family: inherit;
        }
        .pwa-dismiss {
            background: none; border: none;
            color: rgba(255,255,255,0.35);
            font-size: 1rem; cursor: pointer;
            padding: 0.2rem;
        }

        /* ============================================================
           ‚òÖ WELCOME SCREEN
        ============================================================ */
        #welcome {
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem 1.2rem;
            padding-top: 80px;
        }

        .welcome__glow {
            position: absolute;
            width: 420px; height: 420px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(106,90,249,0.18) 0%, transparent 70%);
            top: 50%; left: 50%;
            transform: translate(-50%,-50%);
            pointer-events: none;
            animation: glowPulse 4s ease-in-out infinite;
        }
        @keyframes glowPulse {
            0%,100% { transform: translate(-50%,-50%) scale(1); opacity:.6; }
            50%     { transform: translate(-50%,-50%) scale(1.12); opacity:1; }
        }

        .welcome__avatar {
            position: relative; z-index: 1;
            width: 140px; height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--secondary);
            box-shadow: 0 0 40px rgba(214,110,253,0.4), 0 0 80px rgba(106,90,249,0.15);
            animation: avatarIn 0.6s 0.1s cubic-bezier(.4,0,.2,1) both;
        }
        @keyframes avatarIn {
            from { transform: scale(0.7); opacity:0; }
            to   { transform: scale(1);   opacity:1; }
        }

        .welcome__title {
            position: relative; z-index: 1;
            font-size: 2.6rem;
            font-weight: 800;
            margin-top: 1.4rem;
            background: linear-gradient(to right, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text; background-clip: text;
            color: transparent;
            animation: fadeUp 0.5s 0.25s both;
        }
        .welcome__sub {
            position: relative; z-index: 1;
            color: rgba(255,255,255,0.55);
            font-size: 1rem;
            margin-top: 0.45rem;
            max-width: 380px;
            line-height: 1.55;
            animation: fadeUp 0.5s 0.35s both;
        }
        @keyframes fadeUp {
            from { opacity:0; transform: translateY(14px); }
            to   { opacity:1; transform: translateY(0); }
        }

        .welcome__tags {
            position: relative; z-index: 1;
            display: flex; flex-wrap: wrap;
            justify-content: center;
            gap: 0.55rem;
            margin-top: 1.6rem;
            animation: fadeUp 0.5s 0.45s both;
        }
        .welcome__tag {
            background: rgba(106,90,249,0.13);
            border: 1px solid rgba(106,90,249,0.25);
            border-radius: 50px;
            padding: 0.38rem 1rem;
            font-size: 0.78rem;
            color: rgba(255,255,255,0.7);
            display: flex; align-items: center; gap: 0.4rem;
        }
        .welcome__tag i { color: var(--accent); font-size: 0.72rem; }

        .welcome__cta {
            position: relative; z-index: 1;
            margin-top: 2.2rem;
            animation: fadeUp 0.5s 0.55s both;
        }
        .btn-cta {
            display: inline-flex; align-items: center; gap: 0.6rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            border: none;
            padding: 0.9rem 2.2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 6px 24px rgba(106,90,249,0.4);
            transition: transform 0.25s, box-shadow 0.25s;
        }
        .btn-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 32px rgba(106,90,249,0.5);
        }
        .btn-cta:active { transform: translateY(0); }

        .welcome__links {
            position: relative; z-index: 1;
            margin-top: 2.4rem;
            display: flex; gap: 1.4rem;
            animation: fadeUp 0.5s 0.65s both;
        }
        .welcome__links a {
            color: rgba(255,255,255,0.38);
            font-size: 0.72rem;
            text-decoration: none;
            transition: color 0.2s;
        }
        .welcome__links a:hover { color: var(--accent); }

        /* ============================================================
           ‚òÖ ABOUT SCREEN
        ============================================================ */
        #about {
            padding-top: 80px;
        }

        .about__hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 3rem 1.5rem 2rem;
            gap: 1.2rem;
        }
        .about__avatar {
            width: 110px; height: 110px;
            border-radius: 50%; object-fit: cover;
            border: 3px solid var(--secondary);
            box-shadow: 0 0 30px rgba(214,110,253,0.35);
        }
        .about__name {
            font-size: 2rem; font-weight: 800;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text; background-clip: text;
            color: transparent;
        }
        .about__role {
            color: var(--accent);
            font-size: 0.82rem;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
        }
        .about__tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 0.3rem 1rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        .about__desc {
            max-width: 560px;
            color: rgba(255,255,255,0.6);
            line-height: 1.7;
            font-size: 0.9rem;
        }

        .about__skills {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(230px,1fr));
            gap: 1rem;
            padding: 0 1.5rem;
            max-width: 900px;
            margin: 0 auto;
        }
        .about__card {
            background: var(--card-bg);
            backdrop-filter: blur(8px);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            padding: 1.4rem;
            transition: transform 0.25s, border-color 0.25s, box-shadow 0.25s;
        }
        .about__card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 8px 24px rgba(106,90,249,0.2);
        }
        .about__card-icon {
            font-size: 1.6rem;
            color: var(--primary);
            margin-bottom: 0.7rem;
        }
        .about__card h3 {
            font-size: 1rem; margin-bottom: 0.4rem;
        }
        .about__card p {
            font-size: 0.78rem;
            color: rgba(255,255,255,0.5);
            line-height: 1.55;
        }

        .about__status {
            display: flex; align-items: center; gap: 0.5rem;
            justify-content: center;
            margin: 2rem 0 1rem;
        }
        .status-dot {
            width: 9px; height: 9px;
            border-radius: 50%;
            background: #4CAF50;
            box-shadow: 0 0 6px #4CAF50;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%,100% { opacity:1; }
            50%      { opacity:0.4; }
        }
        .about__status span { font-size: 0.78rem; color: rgba(255,255,255,0.5); }

        .about__legal {
            max-width: 560px;
            margin: 1.5rem auto 0;
            padding: 0 1.5rem 2.5rem;
            display: flex; flex-wrap: wrap;
            justify-content: center;
            gap: 0.8rem;
        }
        .about__legal a {
            color: rgba(255,255,255,0.35);
            font-size: 0.72rem;
            text-decoration: none;
            display: flex; align-items: center; gap: 0.35rem;
            transition: color 0.2s;
        }
        .about__legal a:hover { color: var(--accent); }

        /* ============================================================
           ‚òÖ CHAT SCREEN
        ============================================================ */
        #chat-screen {
            padding-top: 62px;
        }

        .chat__wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 62px);
        }

        /* Ad slot inside chat */
        .ad-slot {
            text-align: center;
            padding: 0.4rem 0;
            min-height: 50px;
            display: flex; align-items: center; justify-content: center;
        }

        .chat__messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 1rem 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }
        .chat__messages::-webkit-scrollbar { width: 5px; }
        .chat__messages::-webkit-scrollbar-track { background: transparent; }
        .chat__messages::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 99px;
        }

        .msg {
            display: flex; gap: 0.7rem;
            animation: msgIn 0.3s cubic-bezier(.4,0,.2,1);
            max-width: 100%;
        }
        @keyframes msgIn {
            from { opacity:0; transform: translateY(8px); }
            to   { opacity:1; transform: translateY(0); }
        }
        .msg--user { flex-direction: row-reverse; }

        .msg__avatar {
            width: 34px; height: 34px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            align-self: flex-end;
        }

        .msg__bubble {
            max-width: 78%;
            padding: 0.7rem 1rem;
            border-radius: 16px 16px 16px 4px;
            background: rgba(106,90,249,0.15);
            border: 1px solid rgba(106,90,249,0.22);
            font-size: 0.85rem;
            line-height: 1.55;
            word-break: break-word;
        }
        .msg--user .msg__bubble {
            border-radius: 16px 16px 4px 16px;
            background: rgba(214,110,253,0.15);
            border-color: rgba(214,110,253,0.22);
        }
        .msg__bubble ul { padding-left: 1.2rem; margin: 0.3rem 0; }
        .msg__bubble li { margin-bottom: 0.2rem; }

        /* typing dots */
        .typing { display: inline-flex; gap: 4px; padding: 0.55rem 0.2rem; }
        .typing span {
            width: 7px; height: 7px;
            border-radius: 50%;
            background: var(--primary);
            animation: dot 1.4s infinite ease-in-out;
        }
        .typing span:nth-child(2){ animation-delay:-.16s; }
        .typing span:nth-child(3){ animation-delay:-.32s; }
        @keyframes dot {
            0%,80%,100% { transform:scale(0); opacity:.4; }
            40%         { transform:scale(1); opacity:1; }
        }

        /* Chat bottom bar */
        .chat__bottom {
            padding: 0.7rem 0.8rem 1rem;
            background: rgba(15,12,41,0.7);
            backdrop-filter: blur(10px);
        }
        .chat__input-row {
            display: flex; gap: 0.5rem; align-items: center;
        }
        .chat__input {
            flex: 1;
            padding: 0.75rem 1.2rem;
            border-radius: 50px;
            border: 1.5px solid rgba(106,90,249,0.35);
            background: var(--input-bg);
            color: var(--light);
            font-size: 0.88rem;
            outline: none;
            transition: border-color 0.25s, box-shadow 0.25s;
            font-family: inherit;
        }
        .chat__input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 10px rgba(214,110,253,0.3);
        }
        .chat__input::placeholder { color: rgba(255,255,255,0.3); }

        .chat__send {
            width: 44px; height: 44px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 14px rgba(106,90,249,0.35);
            flex-shrink: 0;
        }
        .chat__send:hover { transform: scale(1.08); box-shadow: 0 6px 20px rgba(106,90,249,0.45); }
        .chat__send:disabled { opacity: 0.45; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Quick actions */
        .chat__quick {
            display: flex; flex-wrap: wrap; gap: 0.5rem;
            margin-top: 0.7rem;
            justify-content: center;
        }
        .chat__quick button {
            background: rgba(255,142,110,0.12);
            border: 1px solid rgba(255,142,110,0.25);
            color: var(--accent);
            padding: 0.38rem 0.9rem;
            border-radius: 50px;
            font-size: 0.72rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.2s, transform 0.2s;
        }
        .chat__quick button:hover {
            background: rgba(255,142,110,0.22);
            transform: translateY(-1px);
        }

        /* ============================================================
           LIMIT POP-UP (modal)
        ============================================================ */
        .modal-overlay {
            display: none;
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(4px);
            z-index: 500;
            justify-content: center;
            align-items: center;
            animation: overlayIn 0.2s;
        }
        .modal-overlay.show { display: flex; }
        @keyframes overlayIn { from{opacity:0} to{opacity:1} }

        .modal {
            background: linear-gradient(145deg, #1e1b3a, #2a2555);
            border: 1px solid rgba(106,90,249,0.3);
            border-radius: 22px;
            padding: 2.2rem 1.8rem;
            max-width: 360px;
            width: 90%;
            text-align: center;
            animation: modalIn 0.3s cubic-bezier(.4,0,.2,1);
            box-shadow: 0 20px 60px rgba(0,0,0,0.45);
        }
        @keyframes modalIn {
            from { opacity:0; transform: scale(.88) translateY(20px); }
            to   { opacity:1; transform: scale(1)  translateY(0); }
        }
        .modal__icon {
            font-size: 3rem;
            margin-bottom: 0.8rem;
        }
        .modal h2 {
            font-size: 1.35rem;
            margin-bottom: 0.6rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text; background-clip: text;
            color: transparent;
        }
        .modal p {
            color: rgba(255,255,255,0.55);
            font-size: 0.82rem;
            line-height: 1.6;
            margin-bottom: 1.2rem;
        }
        .modal__close {
            display: inline-flex; align-items: center; gap: 0.4rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff; border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-size: 0.78rem; font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            transition: transform 0.2s;
        }
        .modal__close:hover { transform: scale(1.05); }

        /* ============================================================
           COOKIE BANNER (LGPD)
        ============================================================ */
        #cookie-banner {
            display: none;
            position: fixed; bottom: 0; left: 0; right: 0;
            z-index: 400;
            background: rgba(15,12,41,0.93);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(106,90,249,0.25);
            padding: 1rem 1.4rem;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        #cookie-banner.show { display: flex; }
        #cookie-banner p {
            flex: 1;
            min-width: 200px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.6);
            line-height: 1.5;
        }
        #cookie-banner p a { color: var(--accent); text-decoration: none; }
        .cookie-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none; color: #fff;
            padding: 0.42rem 1rem;
            border-radius: 50px;
            font-size: 0.73rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            white-space: nowrap;
        }
        .cookie-btn--outline {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.55);
        }

        /* ============================================================
           RESPONSIVE
        ============================================================ */
        @media (max-width: 480px) {
            .topbar { padding: 0.7rem 1rem; }
            .topbar__logo-text h1 { font-size: 1.1rem; }
            .topbar__nav button { padding: 0.35rem 0.7rem; font-size: 0.76rem; }
            .welcome__title { font-size: 2rem; }
            .welcome__avatar { width: 110px; height: 110px; }
            .about__skills { grid-template-columns: 1fr; padding: 0 1rem; }
            .chat__messages { padding: 0.8rem 0.6rem 0.4rem; }
            .btn-cta { padding: 0.8rem 1.6rem; font-size: 0.9rem; }
        }
    </style>
</head>
<body>

<!-- ========================================================
     TOP BAR
======================================================== -->
<header class="topbar">
    <a href="#" class="topbar__logo" onclick="navigate('welcome')">
        <img src="https://i.imgur.com/qpeNAU8.png" alt="Sion">
        <div class="topbar__logo-text">
            <h1>Sion AI</h1>
            <span>Assistente Especializada</span>
        </div>
    </a>
    <nav class="topbar__nav">
        <button class="active" data-screen="welcome" onclick="navigate('welcome')">In√≠cio</button>
        <button data-screen="about"   onclick="navigate('about')">Sobre</button>
        <button data-screen="chat-screen" onclick="navigate('chat-screen')">Chat</button>
    </nav>
</header>

<!-- PWA Install Banner -->
<div id="pwa-banner">
    <p>Adicione a <strong>Sion AI</strong> √† sua tela de in√≠cio para uma experi√™ncia completa!</p>
    <button class="pwa-btn" id="pwa-install-btn">Instalar</button>
    <button class="pwa-dismiss" id="pwa-dismiss-btn"><i class="fas fa-times"></i></button>
</div>

<!-- ========================================================
     SCREEN 1 ‚Äî WELCOME
======================================================== -->
<section id="welcome" class="screen active">
    <div class="welcome__glow"></div>
    <img src="https://i.imgur.com/qpeNAU8.png" alt="Sion" class="welcome__avatar">

    <h1 class="welcome__title">Ol√°, sou a Sion!</h1>
    <p class="welcome__sub">Sua assistente especializada em programa√ß√£o, animes e idiomas ‚Äî aqui para ajudar com energia e simpatia.</p>

    <div class="welcome__tags">
        <span class="welcome__tag"><i class="fas fa-code"></i> Programa√ß√£o</span>
        <span class="welcome__tag"><i class="fas fa-tv"></i> Animes</span>
        <span class="welcome__tag"><i class="fas fa-language"></i> Idiomas</span>
        <span class="welcome__tag"><i class="fas fa-brain"></i> Calma & Paci√™ncia</span>
    </div>

    <div class="welcome__cta">
        <button class="btn-cta" onclick="navigate('chat-screen')">
            <i class="fas fa-comments"></i> Come√ßar a conversar
        </button>
    </div>

    <div class="welcome__links">
        <a href="#" onclick="navigate('about')">Sobre a Sion</a>
        <span style="color:rgba(255,255,255,0.15)">/</span>
        <a href="https://politicas.cici.net.br" target="_blank">Pol√≠tica de Privacidade</a>
    </div>
</section>

<!-- ========================================================
     SCREEN 2 ‚Äî ABOUT
======================================================== -->
<section id="about" class="screen">
    <div class="about__hero">
        <img src="https://i.imgur.com/qpeNAU8.png" alt="Sion" class="about__avatar">
        <h1 class="about__name">Sion</h1>
        <p class="about__role">IA Especializada ¬∑ Assistente Virtual</p>
        <span class="about__tag">Personalidade: Energ√©tica</span>
        <p class="about__desc">
            Sou a Sion, uma assistente inteligente criada para ser seu parceira no aprendizado.
            Especializada em programa√ß√£o, recomenda√ß√µes de animes e ensino de idiomas ‚Äî
            sempre paciente e com energia para te ajudar no que precisar.
        </p>
    </div>

    <div class="about__skills">
        <div class="about__card">
            <div class="about__card-icon"><i class="fas fa-code"></i></div>
            <h3>Programa√ß√£o</h3>
            <p>Ajuda com JavaScript, Python, HTML/CSS, frameworks, resolu√ß√£o de bugs e projetos pessoais.</p>
        </div>
        <div class="about__card">
            <div class="about__card-icon"><i class="fas fa-tv"></i></div>
            <h3>Recomenda√ß√£o de Animes</h3>
            <p>Recomenda√ß√µes personalizadas por g√™nero, cl√°ssicos, lan√ßamentos e an√°lises detalhadas.</p>
        </div>
        <div class="about__card">
            <div class="about__card-icon"><i class="fas fa-language"></i></div>
            <h3>Ensino de Idiomas</h3>
            <p>Aulas de ingl√™s, japon√™s, espanhol e mais. Pron√∫ncia, gram√°tica e conversa√ß√£o.</p>
        </div>
        <div class="about__card">
            <div class="about__card-icon"><i class="fas fa-brain"></i></div>
            <h3>Tom Calmo & Compreensivo</h3>
            <p>Sempre paciente para tirar suas d√∫vidas, n√£o importa o n√≠vel de experi√™ncia.</p>
        </div>
    </div>

    <div class="about__status">
        <div class="status-dot"></div>
        <span>Conectada √† Mistral AI</span>
    </div>

    <div class="about__legal">
        <a href="https://termos.cici.net.br" target="_blank"><i class="fas fa-file-contract"></i> Termos de Uso</a>
        <a href="https://politicas.cici.net.br" target="_blank"><i class="fas fa-shield-alt"></i> Pol√≠tica de Privacidade</a>
        <a href="https://eula.cici.net.br" target="_blank"><i class="fas fa-user-check"></i> EULA</a>
    </div>
</section>

<!-- ========================================================
     SCREEN 3 ‚Äî CHAT
======================================================== -->
<section id="chat-screen" class="screen">
    <div class="chat__wrapper">
        <!-- Ad slot top -->
        <div class="ad-slot">
            <ins class="adsbygoogle" style="display:block; width:100%; height:50px;"
                 data-ad-client="ca-pub-REPLACE_WITH_YOUR_PUBLISHER_ID"
                 data-ad-slot="REPLACE_WITH_YOUR_AD_SLOT"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>

        <div class="chat__messages" id="chatMessages">
            <!-- Initial greeting injected by JS -->
        </div>

        <div class="chat__bottom">
            <div class="chat__input-row">
                <input type="text" class="chat__input" id="chatInput" placeholder="Digite sua mensagem‚Ä¶" autocomplete="off">
                <button class="chat__send" id="sendButton"><i class="fas fa-paper-plane"></i></button>
            </div>
            <div class="chat__quick">
                <button onclick="askQuestion('Como aprender JavaScript?')"><i class="fas fa-code"></i> JavaScript</button>
                <button onclick="askQuestion('Recomende um anime de aventura')"><i class="fas fa-tv"></i> Anime</button>
                <button onclick="askQuestion('Como dizer ol√° em japon√™s?')"><i class="fas fa-language"></i> Japon√™s</button>
                <button onclick="askQuestion('O que √© React?')"><i class="fab fa-react"></i> React</button>
            </div>
        </div>
    </div>
</section>

<!-- ========================================================
     LIMIT MODAL
======================================================== -->
<div class="modal-overlay" id="limitModal">
    <div class="modal">
        <div class="modal__icon">üåô</div>
        <h2>O Sion precisa de uma pausa.</h2>
        <p>
            Voc√™ atingiu o limite de uso di√°rio.
            O Sion retorna amanh√£ com energia renovada para continuar te ajudando!<br><br>
            <em>Limite atualiza √† meia-noite (hor√°rio de Bras√≠lia).</em>
        </p>
        <button class="modal__close" onclick="closeModal()">
            <i class="fas fa-check"></i> Entendido
        </button>
    </div>
</div>

<!-- ========================================================
     COOKIE BANNER (LGPD)
======================================================== -->
<div id="cookie-banner">
    <p>
        Usamos cookies para melhorar sua experi√™ncia e analisar o uso do site, conforme a
        <a href="https://politicas.cici.net.br" target="_blank">Pol√≠tica de Privacidade</a> e em conformidade com a
        <strong style="color:rgba(255,255,255,0.6)">Lei 13.709/2019 (LGPD)</strong>.
        Ao continuar navegando, voc√™ consente ao uso de cookies n√£o essenciais.
    </p>
    <button class="cookie-btn" id="cookie-accept">Aceitar</button>
    <button class="cookie-btn cookie-btn--outline" id="cookie-decline">Recusar</button>
</div>

<!-- ========================================================
     SCRIPTS
======================================================== -->
<script>
// ============================================================
// 1. NAVIGATION
// ============================================================
function navigate(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
    document.querySelectorAll('.topbar__nav button').forEach(b => {
        b.classList.toggle('active', b.dataset.screen === screenId);
    });
    // Init chat greeting once
    if (screenId === 'chat-screen' && !chatInitialized) initChat();
    window.scrollTo(0, 0);
}

// ============================================================
// 2. PWA SERVICE WORKER & INSTALL
// ============================================================
let deferredInstallPrompt = null;

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(() => {});
}

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredInstallPrompt = e;
    document.getElementById('pwa-banner').classList.add('show');
});

document.getElementById('pwa-install-btn').addEventListener('click', () => {
    if (deferredInstallPrompt) {
        deferredInstallPrompt.prompt();
        deferredInstallPrompt.userChoice.then(() => {
            deferredInstallPrompt = null;
            document.getElementById('pwa-banner').classList.remove('show');
        });
    }
});

document.getElementById('pwa-dismiss-btn').addEventListener('click', () => {
    document.getElementById('pwa-banner').classList.remove('show');
});

// ============================================================
// 3. COOKIE BANNER (LGPD)
// ============================================================
(function initCookies() {
    const status = localStorage.getItem('sion_cookie_consent');
    if (!status) {
        document.getElementById('cookie-banner').classList.add('show');
    }
})();

document.getElementById('cookie-accept').addEventListener('click', () => {
    localStorage.setItem('sion_cookie_consent', 'accepted');
    document.getElementById('cookie-banner').classList.remove('show');
    // Enable analytics (Clarity already loaded; AdSense already loaded)
});

document.getElementById('cookie-decline').addEventListener('click', () => {
    localStorage.setItem('sion_cookie_consent', 'declined');
    document.getElementById('cookie-banner').classList.remove('show');
    // Optionally block non-essential scripts here
});

// ============================================================
// 4. SUPABASE ‚Äî USAGE TRACKING (20 tokens/day)
// ============================================================
const SUPABASE_URL = 'https://onyhbarnwvoqpwveyvhc.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ueWhiYXJud3ZvcXB3dmV5dmhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1OTY0NDQsImV4cCI6MjA3MzE3MjQ0NH0.2zqN73ZxkqxlWLp49Kmrg1CUau0YAi7dee2EIyhodoI';
const DAILY_LIMIT  = 20;

// Generate or retrieve anonymous user ID
function getUserId() {
    let uid = localStorage.getItem('sion_uid');
    if (!uid) {
        uid = crypto.randomUUID ? crypto.randomUUID() : (Date.now().toString(36) + Math.random().toString(36).slice(2));
        localStorage.setItem('sion_uid', uid);
    }
    return uid;
}

// Get today's date string in BRT (UTC-3)
function getTodayBRT() {
    const now = new Date();
    const brt = new Date(now.getTime() - 3 * 60 * 60 * 1000);
    return brt.toISOString().split('T')[0]; // YYYY-MM-DD
}

let cachedCount = null; // local cache to avoid repeated fetches

// Fetch today's token count from Supabase
async function fetchUsageCount() {
    try {
        const res = await fetch(
            `${SUPABASE_URL}/rest/v1/usage?user_id=eq.${getUserId()}&date=eq.${getTodayBRT()}`,
            { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }
        );
        const rows = await res.json();
        cachedCount = (rows && rows.length > 0 && rows[0].tokens) || 0;
    } catch {
        cachedCount = cachedCount ?? 0; // fallback to local cache
    }
    return cachedCount;
}

// Upsert (insert or increment) usage in Supabase
async function incrementUsage() {
    const uid   = getUserId();
    const today = getTodayBRT();
    try {
        // Try insert first
        const insertRes = await fetch(`${SUPABASE_URL}/rest/v1/usage`, {
            method: 'POST',
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`,
                'Content-Type': 'application/json',
                'Prefer': 'resolution=merge-duplicates'
            },
            body: JSON.stringify({ user_id: uid, date: today, tokens: 1 })
        });

        // If conflict (row exists), update by incrementing
        if (insertRes.status === 409 || insertRes.status === 400) {
            await fetch(
                `${SUPABASE_URL}/rest/v1/rpc/increment_usage`,
                {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ p_user_id: uid, p_date: today })
                }
            );
        }
        cachedCount = (cachedCount ?? 0) + 1;
    } catch {
        // Fallback: increment local cache only
        cachedCount = (cachedCount ?? 0) + 1;
    }
}

// Check if user has reached the daily limit
async function checkLimit() {
    const count = await fetchUsageCount();
    return count >= DAILY_LIMIT;
}

// Show the limit modal
function showLimitModal() {
    document.getElementById('limitModal').classList.add('show');
}
function closeModal() {
    document.getElementById('limitModal').classList.remove('show');
}

// ============================================================
// 5. CHAT ENGINE
// ============================================================
const API_URL = 'http://localhost:3000/api/chat';
let isProcessing   = false;
let chatInitialized = false;

function initChat() {
    if (chatInitialized) return;
    chatInitialized = true;
    const container = document.getElementById('chatMessages');
    container.innerHTML = '';
    addMessage(
        `Ol√°! Eu sou a Sion! üòä<br><br>Como posso te ajudar hoje? Pode me perguntar sobre:<br>
         <ul><li>Programa√ß√£o (JavaScript, Python, etc.)</li>
             <li>Recomenda√ß√µes de animes</li>
             <li>Aprender idiomas (ingl√™s, japon√™s, etc.)</li></ul><br>
         Estou conectada √† Mistral AI para te responder com precis√£o!`,
        'sion'
    );
}

function addMessage(html, sender, isTyping = false) {
    const container = document.getElementById('chatMessages');
    const msg = document.createElement('div');
    msg.className = 'msg' + (sender === 'user' ? ' msg--user' : '');

    if (isTyping) {
        msg.id = 'typing-msg';
        msg.innerHTML = `
            <img src="https://i.imgur.com/qpeNAU8.png" alt="Sion" class="msg__avatar">
            <div class="msg__bubble"><div class="typing"><span></span><span></span><span></span></div></div>`;
    } else if (sender === 'sion') {
        msg.innerHTML = `
            <img src="https://i.imgur.com/qpeNAU8.png" alt="Sion" class="msg__avatar">
            <div class="msg__bubble">${html}</div>`;
    } else {
        msg.innerHTML = `
            <img src="https://ui-avatars.com/api/?name=U&background=6a5af9&color=fff&size=68" alt="Usu√°rio" class="msg__avatar">
            <div class="msg__bubble">${escapeHtml(html)}</div>`;
    }

    container.appendChild(msg);
    container.scrollTop = container.scrollHeight;
}

function removeTyping() {
    const t = document.getElementById('typing-msg');
    if (t) t.remove();
}

function escapeHtml(text) {
    const d = document.createElement('div');
    d.textContent = text;
    return d.innerHTML;
}

function formatResponse(text) {
    let f = escapeHtml(text);
    f = f.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    f = f.replace(/\*(.*?)\*/g, '<em>$1</em>');
    f = f.replace(/^- (.*?)$/gm, '<li>$1</li>');
    f = f.replace(/(<li>[\s\S]*<\/li>)/g, '<ul>$1</ul>');
    f = f.replace(/\n/g, '<br>');
    return f;
}

async function sendMessage() {
    if (isProcessing) return;

    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    if (!message) return;

    // --- CHECK DAILY LIMIT ---
    const limitReached = await checkLimit();
    if (limitReached) { showLimitModal(); return; }

    // UI update
    addMessage(message, 'user');
    input.value = '';
    addMessage('', 'sion', true);

    isProcessing = true;
    document.getElementById('sendButton').disabled = true;

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message,
                context: "Voc√™ √© Sion, uma IA especialista em programa√ß√£o, recomenda√ß√£o de animes e ensino de idiomas. Seu tom √© calmo, simp√°tico e compreens√≠vel, mas com personalidade energ√©tica. Responda em portugu√™s brasileiro."
            })
        });

        if (!response.ok) throw new Error(`Erro ${response.status}`);

        const data = await response.json();
        removeTyping();

        if (data.response) {
            addMessage(formatResponse(data.response), 'sion');
            // --- INCREMENT USAGE AFTER SUCCESSFUL RESPONSE ---
            await incrementUsage();
        } else {
            addMessage('Desculpe, n√£o consegui processar sua mensagem. Poderia tentar novamente?', 'sion');
        }
    } catch (err) {
        console.error(err);
        removeTyping();
        addMessage('Ops! Estou com dificuldades para conectar ao servidor. Tente novamente mais tarde. üòä', 'sion');
    } finally {
        isProcessing = false;
        document.getElementById('sendButton').disabled = false;
        input.focus();
    }
}

function askQuestion(q) {
    document.getElementById('chatInput').value = q;
    sendMessage();
}

// ============================================================
// 6. EVENT LISTENERS
// ============================================================
document.getElementById('sendButton').addEventListener('click', sendMessage);
document.getElementById('chatInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});

// AdSense push (runs once DOM is ready)
window.addEventListener('DOMContentLoaded', () => {
    try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch(e) {}
});
</script>
</body>
</html>